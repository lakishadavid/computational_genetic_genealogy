<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab 3: Quality Control | Computational Genetic Genealogy</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="../jupyterlite/css/jupyterlite-integration.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="../jupyterlite/js/jupyterlite-integration.js" defer></script>
</head>
<body class="textbook-page">
    <header class="textbook-header">
        <div class="container">
            <h1>Computational Genetic Genealogy</h1>
            <p>Quality Control for Genetic Data</p>
        </div>
    </header>

    <nav class="textbook-nav">
        <div class="container">
            <a href="../index.html"><i class="fas fa-arrow-left"></i> Back to Main Page</a>
            <a href="contents.html">Table of Contents</a>
            <a href="lab3_qc.html" class="active">Lab 3 qc</a>
        </div>
    </nav>

    <main class="container">
        <article class="section lab-content">
            <h2>Lab 3: Quality Control for Genetic Data</h2>
            
            <div class="alert alert-info">
                <p><strong>Conceptual Foundations:</strong> The reliability of genetic genealogy analyses depends fundamentally on the quality of the underlying genetic data. This lab explains why quality control is a critical step, what can go wrong in genetic data, and how to systematically identify and address data quality issues.</p>
            </div>

            <h3>Core Concepts</h3>
            
            <div class="concept-section">
                <h4>The Critical Role of Data Quality in Genetic Genealogy</h4>
                <p>Genetic genealogy relies on detecting subtle patterns of genetic similarity between individuals. Poor data quality can both:</p>
                <ul>
                    <li><strong>Create false signals</strong> of genetic relatedness where none exists</li>
                    <li><strong>Obscure true signals</strong> of genetic relationships</li>
                </ul>
                <p>The code you'll implement in this lab applies statistical methods to systematically identify and remove problematic data that could lead to incorrect genealogical conclusions. This is especially important when working with data from diverse sources like consumer testing companies and public databases, where standardization can be limited.</p>
            </div>

            <div class="concept-section">
                <h4>Sources of Error in Genetic Data</h4>
                <p>Understanding where errors come from helps you recognize and address them effectively:</p>
                <ul>
                    <li><strong>Technical Sources:</strong>
                        <ul>
                            <li>Sequencing errors during DNA reading</li>
                            <li>Probe binding inconsistencies in microarray genotyping</li>
                            <li>Sample contamination during collection or processing</li>
                            <li>Batch effects between different processing runs</li>
                        </ul>
                    </li>
                    <li><strong>Computational Sources:</strong>
                        <ul>
                            <li>Errors in variant calling algorithms</li>
                            <li>Incorrect genome alignment</li>
                            <li>Reference bias in the alignment process</li>
                            <li>Data format conversion issues</li>
                        </ul>
                    </li>
                    <li><strong>Biological Confounders:</strong>
                        <ul>
                            <li>Copy number variations that complicate genotyping</li>
                            <li>Structural variants that aren't captured by standard approaches</li>
                            <li>Regions with high repetitive content</li>
                        </ul>
                    </li>
                </ul>
                <p>The filtering approaches in the lab aim to identify data points likely to contain these errors without requiring detailed knowledge of their specific sources.</p>
            </div>

            <div class="concept-section">
                <h4>Quality Metrics and Their Biological Meaning</h4>
                <p>Each quality metric you'll calculate in the lab reveals something about the underlying biological data:</p>
                <ul>
                    <li><strong>Call Rate (Missingness):</strong> 
                        <ul>
                            <li><em>Biological meaning:</em> Some genomic regions are inherently difficult to sequence or genotype accurately</li>
                            <li><em>Impact on genealogy:</em> Missing data creates "gaps" in comparison between individuals, reducing the power to detect relationships</li>
                        </ul>
                    </li>
                    <li><strong>Minor Allele Frequency (MAF):</strong>
                        <ul>
                            <li><em>Biological meaning:</em> Very rare variants may be recent mutations or technical artifacts</li>
                            <li><em>Impact on genealogy:</em> Extremely rare variants provide limited information for population-level comparisons but may be informative for close relationships</li>
                        </ul>
                    </li>
                    <li><strong>Hardy-Weinberg Equilibrium (HWE):</strong>
                        <ul>
                            <li><em>Biological meaning:</em> Significant deviation from expected genotype frequencies can indicate selection, population structure, or genotyping errors</li>
                            <li><em>Impact on genealogy:</em> HWE deviations may create systematic biases in relationship inference</li>
                        </ul>
                    </li>
                    <li><strong>Heterozygosity Rate:</strong>
                        <ul>
                            <li><em>Biological meaning:</em> Extreme heterozygosity can indicate sample contamination or poor genotyping</li>
                            <li><em>Impact on genealogy:</em> Abnormal heterozygosity distorts measures of genetic similarity between individuals</li>
                        </ul>
                    </li>
                </ul>
                <p>When you implement these metrics in code, you're applying statistical approaches to capture fundamental biological properties of the genetic data.</p>
            </div>

            <h3>Statistical and Computational Frameworks</h3>
            
            <div class="concept-section">
                <h4>The Statistical Logic of Quality Filtering</h4>
                <p>Quality filtering involves a fundamental statistical tradeoff between sensitivity (including all true signals) and specificity (excluding false signals):</p>
                <ul>
                    <li><strong>Stringent Filtering:</strong> Removes more potential errors but may discard valid genetic information</li>
                    <li><strong>Lenient Filtering:</strong> Preserves more data but increases the risk of including errors</li>
                </ul>
                <p>The thresholds you'll set in the code (e.g., minimum call rate, MAF range) represent decision points in this tradeoff. For genetic genealogy, moderately stringent filtering is typically preferred because relationship detection requires high-quality data, even if it means working with fewer genetic markers.</p>
            </div>

            <div class="concept-section">
                <h4>Variant-Level vs. Sample-Level Quality Control</h4>
                <p>The lab implements a two-tiered approach to quality control:</p>
                <ul>
                    <li><strong>Variant-Level QC:</strong> 
                        <ul>
                            <li>Evaluates each genetic marker (SNP) across all samples</li>
                            <li>Removes problematic markers that would affect all relationship comparisons</li>
                            <li>Helps eliminate systematic technical artifacts from the dataset</li>
                        </ul>
                    </li>
                    <li><strong>Sample-Level QC:</strong>
                        <ul>
                            <li>Evaluates each individual sample across all markers</li>
                            <li>Identifies and removes low-quality samples that would create misleading relationships</li>
                            <li>Essential when working with data from diverse sources with varying quality</li>
                        </ul>
                    </li>
                </ul>
                <p>This hierarchical approach ensures that both problematic markers and problematic samples are identified, preventing cascading errors in downstream analyses.</p>
            </div>

            <div class="concept-section">
                <h4>Visualization as a Quality Control Tool</h4>
                <p>The visualizations you'll create in the lab serve several critical functions:</p>
                <ul>
                    <li><strong>Distribution Examination:</strong> Histograms of quality metrics reveal patterns that numeric summaries might miss</li>
                    <li><strong>Threshold Selection:</strong> Visual inspection helps identify natural cutpoints in the data distribution</li>
                    <li><strong>Outlier Detection:</strong> Plots highlight anomalous samples or variants that require special attention</li>
                    <li><strong>Before/After Comparison:</strong> Visualizing the dataset before and after filtering demonstrates the impact of quality control</li>
                </ul>
                <p>These visualizations aren't just for presentation—they're analytical tools that help make informed decisions about quality filtering thresholds.</p>
            </div>

            <h3>Applications in Genetic Genealogy</h3>
            
            <div class="concept-section">
                <h4>Relatedness Estimation and Data Quality</h4>
                <p>The quality control steps you implement directly impact the accuracy of relationship detection:</p>
                <ul>
                    <li><strong>False Positive Reduction:</strong> Removing low-quality variants decreases the chance of detecting false IBD segments</li>
                    <li><strong>Signal Enhancement:</strong> Filtering out noisy data makes true relationship patterns more discernible</li>
                    <li><strong>Calibration Improvement:</strong> Quality-controlled data leads to more accurate statistical models for relationship inference</li>
                </ul>
                <p>In the context of reconstructing genealogical relationships, data quality issues compound with each comparison. A dataset with 1% error at the variant level can lead to significantly higher error rates in relationship detection, making quality control essential.</p>
            </div>

            <div class="concept-section">
                <h4>Special Considerations for Open Data and Consumer Tests</h4>
                <p>The OpenSNP data used in this course presents unique quality challenges that the code addresses:</p>
                <ul>
                    <li><strong>Platform Differences:</strong> Data from different testing companies uses different marker sets and technologies</li>
                    <li><strong>Reference Genome Variations:</strong> Some companies use different human genome reference versions</li>
                    <li><strong>Varying Coverage:</strong> The number and distribution of genetic markers differs between platforms</li>
                    <li><strong>Self-Reported Information:</strong> Metadata accuracy may vary in crowd-sourced datasets</li>
                </ul>
                <p>The quality control approach in this lab is designed to be robust to these challenges, making it particularly valuable for working with diverse genetic datasets from multiple sources.</p>
            </div>

            <div class="concept-section">
                <h4>Preparing Data for IBD Detection</h4>
                <p>Quality control is tightly linked to the next phase of genetic genealogy analysis—IBD detection:</p>
                <ul>
                    <li><strong>Phasing Preparation:</strong> High-quality genotype data is essential for accurate phasing (determining which variants are inherited together)</li>
                    <li><strong>Algorithm Requirements:</strong> Different IBD detection algorithms have different sensitivity to data quality issues</li>
                    <li><strong>Computational Efficiency:</strong> Removing poor-quality data reduces computational demands in downstream analyses</li>
                </ul>
                <p>The final steps in the lab, where you prepare filtered data for phasing, create the foundation for all subsequent relationship detection. This connection between quality control and IBD detection illustrates how each step in the computational genetic genealogy workflow builds upon previous steps.</p>
            </div>

            <h3>Broader Implications</h3>
            <p>As you implement these quality control procedures, consider their broader implications:</p>
            <ul>
                <li><strong>Ethical Dimensions:</strong> Quality control decisions affect which genetic relationships will be detectable, potentially impacting individuals' genealogical discoveries</li>
                <li><strong>Equity Considerations:</strong> Some populations may be disproportionately affected by quality filtering due to reference genome biases or differing patterns of genetic variation</li>
                <li><strong>Transparency Requirements:</strong> Documenting quality control decisions is essential for reproducible and interpretable genealogical research</li>
                <li><strong>Methodological Evolution:</strong> Quality control approaches continue to evolve as sequencing technologies and algorithms improve</li>
            </ul>
            <p>These considerations connect the technical procedures you're learning to their real-world impact on genetic genealogy research and applications.</p>
            
            <div class="learning-pathway">
                <p>This lab is part of the sequential learning track:</p>
                <div class="pathway-steps">
                    <div class="pathway-step">
                        <h5>Step 1</h5>
                        <p>Environment Setup</p>
                    </div>
                    <div class="pathway-step">
                        <h5>Step 2</h5>
                        <p>Data Acquisition</p>
                    </div>
                    <div class="pathway-step">
                        <h5>Step 3</h5>
                        <p>Data Exploration</p>
                    </div>
                    <div class="pathway-step">
                        <h5>Step 4</h5>
                        <p>Data Processing</p>
                    </div>
                    <div class="pathway-step active">
                        <h5>Step 5</h5>
                        <p>Quality Control</p>
                    </div>
                    <div class="pathway-step">
                        <h5>Step 6</h5>
                        <p>IBD Detection</p>
                    </div>
                    <div class="pathway-step">
                        <h5>Step 7</h5>
                        <p>Simulation</p>
                    </div>
                    <div class="pathway-step">
                        <h5>Step 8</h5>
                        <p>Pedigrees</p>
                    </div>
                </div>
            </div>
            
            <div class="alert alert-success">
                <p><strong>Tip:</strong> Quality control isn't just a technical necessity—it's an ethical responsibility. When we use genomic data to make claims about relationships and identity, ensuring data quality becomes a matter of respecting the communities whose histories we're studying.</p>
            </div>
            
            <h3>Interactive Lab Environment</h3>
            
            <div class="jupyter-integration">
                <p>Apply quality control measures to genetic data in your browser. This lab builds on data processed in Labs 1 and 2.</p>
                
                <div class="jupyterlite-container">
                    
                    <div class="jupyterlite-info">
                        <h4>Browser-Based Quality Control</h4>
                        <p>This notebook automatically loads your processed data from previous labs and guides you through essential quality control measures for genetic data.</p>
                        <ol>
                            <li>Click the "Open Lab 3 Notebook in JupyterLite" button below</li>
                            <li>In the file browser that appears, click on "<strong>lab3_quality.ipynb</strong>" to open this lab's notebook</li>
                            <li>You can now run the code cells by clicking on them and pressing Shift+Enter</li>
                        </ol>
                        <p>Your progress is automatically saved in your browser's storage.</p>
                    </div>
                    
                    <button class="open-jupyterlite" data-lab="lab3">Open Lab 3 Notebook in JupyterLite</button>
                    
                    <div class="lab-progress" data-lab="lab3">
                        <!-- Progress will be populated by JavaScript -->
                    </div>
                </div>
                
                <div class="alert alert-info">
                    <p><strong>Note:</strong> The interactive notebook automatically loads data from previous labs if you completed them. Your work is saved in your browser's storage between lab sessions.</p>
                </div>
            </div>
            
            <h3>Beyond the Code</h3>
            <p>As you work through the coding exercises in this lab, keep in mind these deeper concepts:</p>
            <ul>
                <li><strong>Data Quality vs. Quantity:</strong> Understanding the trade-off between retaining maximum genetic information and ensuring its reliability</li>
                <li><strong>Statistical Thresholds:</strong> Quality thresholds represent a balance between sensitivity (retaining true information) and specificity (filtering out errors)</li>
                <li><strong>Contextual Evaluation:</strong> Different quality metrics have different importance depending on the downstream genealogical application</li>
                <li><strong>Biological Plausibility:</strong> Quality control serves as a bridge between raw data and biologically meaningful interpretation</li>
            </ul>
            <p>These conceptual frameworks help you understand that quality control is not just about "cleaning" data but about creating a foundation for reliable genealogical inference.</p>
            
            <div class="lab-navigation">
                <a href="lab2_process.html" class="prev-lab">Processing Raw DNA</a>
                <a href="lab4_ibis.html" class="next-lab">IBD Detection with IBIS</a>
            </div>
        </article>
    </main>

    <footer class="textbook-footer">
        <div class="container">
            <p>&copy; 2025 Dr. LaKisha David, Department of Anthropology, University of Illinois Urbana-Champaign</p>
        </div>
    </footer>
</body>
</html>