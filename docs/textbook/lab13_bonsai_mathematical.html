<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab 13: Bonsai Mathematical Foundations | Computational Genetic Genealogy</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body class="textbook-page">
    <header class="textbook-header">
        <div class="container">
            <h1>Computational Genetic Genealogy</h1>
            <p>Mathematical Foundations of Bonsai</p>
        </div>
    </header>

    <nav class="textbook-nav">
        <div class="container">
            <a href="../index.html"><i class="fas fa-arrow-left"></i> Back to Main Page</a>
            <a href="contents.html">Table of Contents</a>
            <a href="lab13_bonsai_mathematical.html" class="active">Lab 13 bonsai mathematical</a>
        </div>
    </nav>

    <main class="container">
        <article class="section lab-content">
            <h2>Lab 13: Mathematical Foundations of Bonsai</h2>
            
            <div class="alert alert-info">
                <p><strong>Why This Matters:</strong> Mathematics serves as the bridge between biological reality and computational inference in genetic genealogy. The probabilistic frameworks that underpin pedigree reconstruction algorithms like Bonsai translate the messy, incomplete patterns of genetic sharing into coherent family structures, quantifying uncertainty and guiding interpretation. Understanding these mathematical foundations reveals both the power and limitations of computational approaches to reconstructing human relationships.</p>
            </div>

            <h3>Core Concepts</h3>
            
            <h4>Probability as Genealogical Reasoning</h4>
            <p>Human genealogical reasoning has always been probabilistic in nature, even when done intuitively. When we recognize family resemblances, deduce relationships from shared physical traits, or interpret documentary evidence, we implicitly evaluate likelihoods and weigh competing explanations. The mathematical foundation of Bonsai formalizes this reasoning in a computational framework.</p>
            
            <p>At the heart of this approach is Bayesian inference, which provides a mathematical framework for updating beliefs based on evidence. In the context of genetic genealogy, this takes the form:</p>
            
            <p style="text-align:center;"><em>P(Pedigree | Genetic Data) ∝ P(Genetic Data | Pedigree) × P(Pedigree)</em></p>
            
            <p>This elegant equation encapsulates the entire enterprise of genetic genealogy:</p>
            <ul>
                <li>The <strong>posterior probability</strong>, <em>P(Pedigree | Genetic Data)</em>, represents our estimate of how likely a particular family structure is, given the genetic evidence we've observed</li>
                <li>The <strong>likelihood</strong>, <em>P(Genetic Data | Pedigree)</em>, quantifies how well a proposed family structure explains the observed patterns of genetic sharing</li>
                <li>The <strong>prior probability</strong>, <em>P(Pedigree)</em>, incorporates our background knowledge about plausible family structures before considering genetic data</li>
            </ul>
            
            <p>This framework provides a principled way to integrate multiple sources of evidence, handle uncertainty, and evaluate competing hypotheses about family relationships. It formalizes the inherently probabilistic nature of genealogical reasoning that humans have practiced throughout history.</p>

            <h4>Likelihood Functions: The Mathematical Language of Relationships</h4>
            <p>Likelihood functions translate biological relationships into mathematical expressions that can be evaluated computationally. They answer the question: "How probable is the observed pattern of genetic sharing if these individuals are related in a particular way?"</p>
            
            <p>For genetic genealogy, likelihood functions must capture several key aspects of inheritance:</p>
            <ul>
                <li>The <strong>randomness of recombination</strong> that creates unique patterns of genetic inheritance in each individual</li>
                <li>The <strong>expected patterns of sharing</strong> between individuals with different relationship types</li>
                <li>The <strong>statistical distributions</strong> that govern segment counts, lengths, and positions</li>
                <li>The <strong>technical uncertainties</strong> introduced by genotyping, phasing, and IBD detection</li>
            </ul>
            
            <p>In Bonsai, these likelihood functions take the form of probabilistic models for IBD segment patterns. The algorithm uses sophisticated statistical models that account for:</p>
            <ul>
                <li><strong>Segment count distributions</strong> based on Poisson-like processes that model the random nature of recombination events</li>
                <li><strong>Segment length distributions</strong> based on exponential models that reflect the fragmentation of ancestral chromosomes over generations</li>
                <li><strong>Total sharing distributions</strong> based on gamma models that capture the overall amount of genetic material inherited from common ancestors</li>
            </ul>
            
            <p>These mathematical representations transform the biological process of genetic inheritance into computational models that can be evaluated and optimized.</p>

            <h3>Theoretical Foundations</h3>
            
            <h4>The IBD Moments Framework</h4>
            <p>A key innovation in Bonsai's mathematical approach is the concept of "IBD moments" – statistical summaries that capture the essential properties of genetic sharing between individuals. These moments provide a computationally efficient way to characterize relationship patterns without needing to store or process the full details of every IBD segment.</p>
            
            <p>The first two moments are particularly informative:</p>
            <ul>
                <li><strong>First Moment (μ₁)</strong>: The number of IBD segments, which tends to increase with relationship distance (up to a point) as recombination creates more, shorter segments</li>
                <li><strong>Second Moment (μ₂)</strong>: The total length of IBD segments, which decreases steadily with relationship distance as less genetic material is shared</li>
            </ul>
            
            <p>The ratio between these moments provides crucial information about relationship type. For example:</p>
            <ul>
                <li>Close relationships like parent-child or siblings have fewer, longer segments (high μ₂/μ₁ ratio)</li>
                <li>Distant relationships like cousins have more numerous, shorter segments (low μ₂/μ₁ ratio)</li>
            </ul>
            
            <p>This moments-based approach represents a mathematical abstraction that captures the essential genealogical information while reducing computational complexity. It transforms the high-dimensional space of possible IBD patterns into a lower-dimensional representation that maintains the key relationship signals.</p>

            <h4>The Pedigree Probability Space</h4>
            <p>From a mathematical perspective, pedigree reconstruction represents a search through an enormous space of possible family structures. This space has several challenging properties:</p>
            <ul>
                <li><strong>Exponential Growth</strong>: The number of possible pedigree configurations grows exponentially with the number of individuals</li>
                <li><strong>Multimodality</strong>: Multiple distinct pedigree structures may explain the observed genetic data equally well</li>
                <li><strong>High Dimensionality</strong>: Each potential relationship represents a dimension in the probability space</li>
                <li><strong>Complex Constraints</strong>: Biological realities (like age relationships and reproductive limitations) create intricate constraints</li>
            </ul>
            
            <p>Navigating this space efficiently requires sophisticated mathematical approaches. Bonsai uses techniques from:</p>
            <ul>
                <li><strong>Graph Theory</strong>: Representing pedigrees as directed acyclic graphs with specific properties</li>
                <li><strong>Optimization Theory</strong>: Finding pedigree structures that maximize likelihood functions</li>
                <li><strong>Stochastic Processes</strong>: Modeling the inherent randomness in genetic inheritance</li>
                <li><strong>Statistical Learning</strong>: Drawing inferences from incomplete and noisy data</li>
            </ul>
            
            <p>The mathematical challenge lies in developing algorithms that can efficiently explore this vast space to find structures that have high posterior probability—those that best explain the observed genetic data while respecting biological constraints.</p>

            <h3>Applications and Implications</h3>
            
            <h4>The Up-Node Dictionary: Graph Theory Meets Genealogy</h4>
            <p>The "up-node dictionary" in Bonsai represents a mathematical innovation that bridges graph theory and genealogy. This data structure encodes the pedigree as a directed graph where:</p>
            <ul>
                <li>Each individual is a node in the graph</li>
                <li>Parent-child relationships are directed edges pointing from child to parent</li>
                <li>The graph must be acyclic (no individual can be their own ancestor)</li>
                <li>Each node can have at most two parent edges (reflecting biparental reproduction)</li>
            </ul>
            
            <p>This representation facilitates efficient traversal of ancestral pathways, calculation of relationship coefficients, and evaluation of alternative pedigree configurations. It also enables the introduction of "latent nodes"—inferred individuals who are not directly observed in the genetic data but whose existence is suggested by patterns of relationship among sampled individuals.</p>
            
            <p>The graph-theoretic approach provides several advantages:</p>
            <ul>
                <li>It naturally encodes the directional flow of genetic material through generations</li>
                <li>It represents complex relationships like half-siblings, double cousins, and consanguinity</li>
                <li>It supports efficient algorithms for relationship coefficient calculation</li>
                <li>It enables incremental pedigree construction through graph manipulations</li>
            </ul>
            
            <p>This mathematical representation transforms genealogical reasoning into a form that computers can process efficiently, while preserving the essential biological constraints of human pedigrees.</p>

            <h4>Optimization Algorithms: The Search for Truth</h4>
            <p>Finding the most likely pedigree structure represents a complex optimization problem. Bonsai employs sophisticated algorithms that balance computational efficiency with thoroughness in exploring the space of possible structures.</p>
            
            <p>The core approach combines:</p>
            <ul>
                <li><strong>Greedy Search</strong>: Making locally optimal choices at each step to build up the pedigree incrementally</li>
                <li><strong>Simulated Annealing</strong>: Occasionally accepting sub-optimal changes to escape local maxima in the probability landscape</li>
                <li><strong>Genetic Algorithms</strong>: Evolving populations of candidate pedigrees through selection and recombination</li>
                <li><strong>Graph Restructuring</strong>: Applying operations like node merging, splitting, and edge rerouting to transform pedigree structures</li>
            </ul>
            
            <p>These techniques embody a profound philosophical point: truth discovery in genetic genealogy is inherently iterative and exploratory. There is rarely a direct path from data to conclusion; instead, we must systematically explore possibilities, evaluate evidence, and refine our understanding incrementally.</p>
            
            <p>The use of stochastic optimization methods also acknowledges the fundamental uncertainty in genealogical inference—there may be multiple plausible explanations for the observed genetic patterns, and we must be prepared to consider alternatives rather than forcing a single answer.</p>

            <h3>Broader Context</h3>
            
            <h4>Mathematical Models and Cultural Understanding</h4>
            <p>The mathematical models embedded in Bonsai reflect particular cultural understandings of kinship and relationship. These models assume:</p>
            <ul>
                <li>A bilineal system of descent through mothers and fathers</li>
                <li>Discrete generations with limited overlapping</li>
                <li>Predominantly outbred populations with low rates of consanguinity</li>
                <li>Nuclear family structures as the primary organizational unit</li>
            </ul>
            
            <p>These assumptions align with contemporary Western models of kinship but may not fully represent the diversity of human kinship systems across cultures and histories. For example:</p>
            <ul>
                <li>Some societies practice preferential cousin marriage, creating complex patterns of consanguinity</li>
                <li>Others recognize unilineal descent through either maternal or paternal lines</li>
                <li>Many cultures have kinship systems that recognize relationships beyond genetic connections</li>
                <li>Historical practices like polygamy create distinctive pedigree structures</li>
            </ul>
            
            <p>The mathematical framework used in Bonsai can be adapted to accommodate some of these variations, but we must remain aware of its cultural situatedness. The algorithm's ability to reconstruct relationships is shaped by the assumptions built into its mathematical models, which in turn reflect particular understandings of kinship and relatedness.</p>

            <h4>The Limits of Mathematical Inference</h4>
            <p>Despite its sophistication, the mathematical framework of Bonsai encounters fundamental limits in pedigree reconstruction. These limitations arise from several sources:</p>
            <ul>
                <li><strong>Genetic Horizon</strong>: Beyond approximately 5-7 generations, the fragmentation of IBD segments creates a natural limit to relationship detection</li>
                <li><strong>Equivalent Structures</strong>: Some distinct pedigree configurations produce statistically indistinguishable patterns of genetic sharing</li>
                <li><strong>Missing Data</strong>: Unsampled individuals create gaps in the relationship network that must be inferred</li>
                <li><strong>Detection Limitations</strong>: Technical constraints in IBD detection create systematic biases in the observed data</li>
            </ul>
            
            <p>These limitations remind us that mathematics, while powerful, cannot fully resolve all genealogical questions. In many cases, the most appropriate mathematical conclusion is to acknowledge uncertainty—to identify multiple plausible relationship configurations rather than forcing a single answer.</p>
            
            <p>This perspective aligns with anthropological approaches to knowledge that recognize the inherent limitations of any single method. Just as traditional genealogists integrate multiple lines of evidence (documents, oral histories, physical resemblances), computational approaches are most effective when used as part of a broader toolkit that includes historical context, cultural understanding, and documentary evidence.</p>

            <div class="exercises-section">
                <h3>Exercises</h3>
            <ol>
                <li>Compare how different cultural kinship systems might be represented using graph-theoretical models, and discuss what adaptations would be needed in Bonsai's mathematical framework to accommodate these systems</li>
                <li>Analyze how the mathematical models for IBD segment inheritance would be affected by historical practices like preferential cousin marriage or polygamy</li>
                <li>Consider how the concept of probability in pedigree reconstruction relates to concepts of certainty and uncertainty in traditional genealogical research</li>
                <li>Explore how the graph-theoretical representation of pedigrees might be extended to represent non-biological kinship relationships recognized in various cultural contexts</li>
                <li>Reflect on the ethical implications of presenting probabilistic results from mathematical models to individuals seeking information about their family relationships</li>
                <li>Analyze how different prior probability distributions might affect pedigree reconstruction in populations with different demographic histories</li>
            </ol>
            </div>

            <div class="alert alert-success">
                <p><strong>Tip:</strong> When working with mathematical models of human relationships, remember that these models are simplifications of complex biological and social realities. Their value lies not in perfect representation but in providing useful frameworks for inference that acknowledge uncertainty and incorporate diverse forms of evidence.</p>
            </div>
            
            <div class="learning-pathway">
                <p>This lab is part of the advanced Bonsai specialization track:</p>
                <div class="pathway-steps">
                    <div class="pathway-step ">
                        <h5>Fundamentals</h5>
                        <p>Lab 12</p>
                    </div>
                    <div class="pathway-step ">
                        <h5>Mathematics</h5>
                        <p>Lab 13</p>
                    </div>
                    <div class="pathway-step ">
                        <h5>Data Structures</h5>
                        <p>Lab 14</p>
                    </div>
                    <div class="pathway-step ">
                        <h5>Calibration</h5>
                        <p>Lab 15</p>
                    </div>
                    <div class="pathway-step ">
                        <h5>Architecture</h5>
                        <p>Lab 16</p>
                    </div>
                    <div class="pathway-step ">
                        <h5>Likelihood</h5>
                        <p>Lab 17</p>
                    </div>
                    <div class="pathway-step ">
                        <h5>Quality</h5>
                        <p>Lab 18</p>
                    </div>
                    <div class="pathway-step ">
                        <h5>Advanced</h5>
                        <p>Lab 19</p>
                    </div>
                    <div class="pathway-step ">
                        <h5>Visualization</h5>
                        <p>Lab 20</p>
                    </div>
                    <div class="pathway-step ">
                        <h5>Applications</h5>
                        <p>Lab 21</p>
                    </div>
                </div>
            </div>
            

            <div class="lab-navigation">
                <a href="lab12_bonsai_fundamentals.html" class="prev-lab">Fundamentals</a>
                <a href="lab14_bonsai_data_structures.html" class="next-lab">Data Structures</a>
            </div>
        </article>
    </main>

    <footer class="textbook-footer">
        <div class="container">
            <p>&copy; 2025 Dr. LaKisha David, Department of Anthropology, University of Illinois Urbana-Champaign</p>
        </div>
    </footer>
</body>
</html>
